#!/bin/bash

# Get a list of all projects in the organization
org_id="339867572913"

# Get a list of projects under the specified organization ID
projects=$(gcloud asset search-all-resources \
  --scope='organizations/339867572913' \
  --asset-types='cloudresourcemanager.googleapis.com/Project' \
  --format="value(additionalAttributes.projectId)")

for project in $projects; do
  echo "Project: $project"
  
  # Get a list of Linux GCE instances in the current project
  instances=$(gcloud compute instances list --project="$project" --filter="status=RUNNING" --format="value(name)")

  if [[ -z "$instances" ]]; then
    echo "  No Linux instances found."
  else
    for instance in $instances; do
      echo "  Instance: $instance"
    done
  fi

  echo ""  # Add an empty line for better readability
done
